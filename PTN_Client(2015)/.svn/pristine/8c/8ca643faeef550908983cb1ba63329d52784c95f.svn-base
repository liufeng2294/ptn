package com.nms.model.equipment.card;

import java.util.ArrayList;
import java.util.List;

import org.apache.ibatis.session.SqlSession;

import com.nms.db.bean.equipment.card.CardInst;
import com.nms.db.bean.equipment.port.PortInst;
import com.nms.db.dao.equipment.card.CardInstMapper;
import com.nms.model.equipment.port.PortService;
import com.nms.model.equipment.port.PortService_MB;
import com.nms.model.util.ObjectService_Mybatis;
import com.nms.model.util.Services;
import com.nms.ui.manager.ConstantUtil;
import com.nms.ui.manager.ExceptionManage;

public class CardService_MB extends ObjectService_Mybatis {
	private CardInstMapper mapper = null;
	
	public void setPtnuser(String ptnuser) {
		super.ptnuser = ptnuser;
	}

	public void setSqlSession(SqlSession sqlSession) {
		super.sqlSession = sqlSession;
	}
	
	public void setMapper(CardInstMapper mapper) {
		this.mapper = mapper;
	}
	/**
	 * 根据条件查询
	 * 
	 * @param cardinst
	 *            查询条件
	 * @return List<CardInst> 集合
	 * @throws Exception
	 */
	public List<CardInst> select(CardInst cardinst) throws Exception {
		List<CardInst> cardinstList = null;
		PortInst portinst = null;
		PortService_MB portService = null;
		List<PortInst> portinstList = null;
		try {
			cardinstList = new ArrayList<CardInst>();
			cardinstList = this.mapper.queryByCondition(cardinst);
			portService = (PortService_MB) ConstantUtil.serviceFactory.newService_MB(Services.PORT, this.sqlSession);
			if (null != cardinstList && cardinstList.size() != 0) {
				for (int i = 0; i < cardinstList.size(); i++) {
					portinst = new PortInst();
					portinst.setCardId(cardinstList.get(i).getId());
					portinstList = portService.select(portinst);
					cardinstList.get(i).setPortList(portinstList);
				}
			}
		} catch (Exception e) {
			ExceptionManage.dispose(e,this.getClass());
		} finally {
			cardinst = null;
			portinst = null;
//			UiUtil.closeService(portService);
			portinstList = null;
		}

		return cardinstList;
	}

}
