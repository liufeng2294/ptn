<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nms.db.dao.alarm.CurrentAlarmInfoMapper" >
  <resultMap id="BaseResultMap" type="CurrentAlarmInfo" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="siteid" property="siteid" jdbcType="INTEGER" />
    <result column="slotId" property="slotid" jdbcType="INTEGER" />
    <result column="objectid" property="objectid" jdbcType="INTEGER" />
    <result column="objecttype" property="objecttype" jdbcType="INTEGER" />
    <result column="objectname" property="objectname" jdbcType="VARCHAR" />
    <result column="alarmcode" property="alarmcode" jdbcType="INTEGER" />
    <result column="alarmlevel" property="alarmlevel" jdbcType="INTEGER" />
    <result column="happenedtime" property="happenedtime" jdbcType="VARCHAR" />
    <result column="confirmtime" property="confirmtime" jdbcType="VARCHAR" />
    <result column="clearedtime" property="clearedtime" jdbcType="VARCHAR" />
    <result column="ackuser" property="ackuser" jdbcType="VARCHAR" />
    <result column="comments" property="comments" jdbcType="VARCHAR" />
    <result column="capabilityCode" property="capabilitycode" jdbcType="INTEGER" />
    <result column="capabilityIdentity" property="capabilityidentity" jdbcType="VARCHAR" />
    <result column="alarmlevel_temp" property="alarmlevelTemp" jdbcType="INTEGER" />
    <result column="isCleared" property="iscleared" jdbcType="INTEGER" />
  </resultMap>
  <sql id="Base_Column_List" >
    id, siteid, slotId, objectid, objecttype, objectname, alarmcode, alarmlevel, happenedtime, 
    confirmtime, clearedtime, ackuser, comments, capabilityCode, capabilityIdentity, 
    alarmlevel_temp, isCleared
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select 
    <include refid="Base_Column_List" />
    from current_alarm
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    delete from current_alarm
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="CurrentAlarmInfo" >
    insert into current_alarm (id, siteid, slotId, 
      objectid, objecttype, objectname, 
      alarmcode, alarmlevel, happenedtime, 
      confirmtime, clearedtime, ackuser, 
      comments, capabilityCode, capabilityIdentity, 
      alarmlevel_temp, isCleared)
    values (#{id,jdbcType=INTEGER}, #{siteid,jdbcType=INTEGER}, #{slotid,jdbcType=INTEGER}, 
      #{objectid,jdbcType=INTEGER}, #{objecttype,jdbcType=INTEGER}, #{objectname,jdbcType=VARCHAR}, 
      #{alarmcode,jdbcType=INTEGER}, #{alarmlevel,jdbcType=INTEGER}, #{happenedtime,jdbcType=VARCHAR}, 
      #{confirmtime,jdbcType=VARCHAR}, #{clearedtime,jdbcType=VARCHAR}, #{ackuser,jdbcType=VARCHAR}, 
      #{comments,jdbcType=VARCHAR}, #{capabilitycode,jdbcType=INTEGER}, #{capabilityidentity,jdbcType=VARCHAR}, 
      #{alarmlevelTemp,jdbcType=INTEGER}, #{iscleared,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="CurrentAlarmInfo" >
    insert into current_alarm
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="siteid != null" >
        siteid,
      </if>
      <if test="slotid != null" >
        slotId,
      </if>
      <if test="objectid != null" >
        objectid,
      </if>
      <if test="objecttype != null" >
        objecttype,
      </if>
      <if test="objectname != null" >
        objectname,
      </if>
      <if test="alarmcode != null" >
        alarmcode,
      </if>
      <if test="alarmlevel != null" >
        alarmlevel,
      </if>
      <if test="happenedtime != null" >
        happenedtime,
      </if>
      <if test="confirmtime != null" >
        confirmtime,
      </if>
      <if test="clearedtime != null" >
        clearedtime,
      </if>
      <if test="ackuser != null" >
        ackuser,
      </if>
      <if test="comments != null" >
        comments,
      </if>
      <if test="capabilitycode != null" >
        capabilityCode,
      </if>
      <if test="capabilityidentity != null" >
        capabilityIdentity,
      </if>
      <if test="alarmlevelTemp != null" >
        alarmlevel_temp,
      </if>
      <if test="iscleared != null" >
        isCleared,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="siteid != null" >
        #{siteid,jdbcType=INTEGER},
      </if>
      <if test="slotid != null" >
        #{slotid,jdbcType=INTEGER},
      </if>
      <if test="objectid != null" >
        #{objectid,jdbcType=INTEGER},
      </if>
      <if test="objecttype != null" >
        #{objecttype,jdbcType=INTEGER},
      </if>
      <if test="objectname != null" >
        #{objectname,jdbcType=VARCHAR},
      </if>
      <if test="alarmcode != null" >
        #{alarmcode,jdbcType=INTEGER},
      </if>
      <if test="alarmlevel != null" >
        #{alarmlevel,jdbcType=INTEGER},
      </if>
      <if test="happenedtime != null" >
        #{happenedtime,jdbcType=VARCHAR},
      </if>
      <if test="confirmtime != null" >
        #{confirmtime,jdbcType=VARCHAR},
      </if>
      <if test="clearedtime != null" >
        #{clearedtime,jdbcType=VARCHAR},
      </if>
      <if test="ackuser != null" >
        #{ackuser,jdbcType=VARCHAR},
      </if>
      <if test="comments != null" >
        #{comments,jdbcType=VARCHAR},
      </if>
      <if test="capabilitycode != null" >
        #{capabilitycode,jdbcType=INTEGER},
      </if>
      <if test="capabilityidentity != null" >
        #{capabilityidentity,jdbcType=VARCHAR},
      </if>
      <if test="alarmlevelTemp != null" >
        #{alarmlevelTemp,jdbcType=INTEGER},
      </if>
      <if test="iscleared != null" >
        #{iscleared,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="CurrentAlarmInfo" >
    update current_alarm
    <set >
      <if test="siteid != null" >
        siteid = #{siteid,jdbcType=INTEGER},
      </if>
      <if test="slotid != null" >
        slotId = #{slotid,jdbcType=INTEGER},
      </if>
      <if test="objectid != null" >
        objectid = #{objectid,jdbcType=INTEGER},
      </if>
      <if test="objecttype != null" >
        objecttype = #{objecttype,jdbcType=INTEGER},
      </if>
      <if test="objectname != null" >
        objectname = #{objectname,jdbcType=VARCHAR},
      </if>
      <if test="alarmcode != null" >
        alarmcode = #{alarmcode,jdbcType=INTEGER},
      </if>
      <if test="alarmlevel != null" >
        alarmlevel = #{alarmlevel,jdbcType=INTEGER},
      </if>
      <if test="happenedtime != null" >
        happenedtime = #{happenedtime,jdbcType=VARCHAR},
      </if>
      <if test="confirmtime != null" >
        confirmtime = #{confirmtime,jdbcType=VARCHAR},
      </if>
      <if test="clearedtime != null" >
        clearedtime = #{clearedtime,jdbcType=VARCHAR},
      </if>
      <if test="ackuser != null" >
        ackuser = #{ackuser,jdbcType=VARCHAR},
      </if>
      <if test="comments != null" >
        comments = #{comments,jdbcType=VARCHAR},
      </if>
      <if test="capabilitycode != null" >
        capabilityCode = #{capabilitycode,jdbcType=INTEGER},
      </if>
      <if test="capabilityidentity != null" >
        capabilityIdentity = #{capabilityidentity,jdbcType=VARCHAR},
      </if>
      <if test="alarmlevelTemp != null" >
        alarmlevel_temp = #{alarmlevelTemp,jdbcType=INTEGER},
      </if>
      <if test="iscleared != null" >
        isCleared = #{iscleared,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="CurrentAlarmInfo" >
    update current_alarm
    set siteid = #{siteid,jdbcType=INTEGER},
      slotId = #{slotid,jdbcType=INTEGER},
      objectid = #{objectid,jdbcType=INTEGER},
      objecttype = #{objecttype,jdbcType=INTEGER},
      objectname = #{objectname,jdbcType=VARCHAR},
      alarmcode = #{alarmcode,jdbcType=INTEGER},
      alarmlevel = #{alarmlevel,jdbcType=INTEGER},
      happenedtime = #{happenedtime,jdbcType=VARCHAR},
      confirmtime = #{confirmtime,jdbcType=VARCHAR},
      clearedtime = #{clearedtime,jdbcType=VARCHAR},
      ackuser = #{ackuser,jdbcType=VARCHAR},
      comments = #{comments,jdbcType=VARCHAR},
      capabilityCode = #{capabilitycode,jdbcType=INTEGER},
      capabilityIdentity = #{capabilityidentity,jdbcType=VARCHAR},
      alarmlevel_temp = #{alarmlevelTemp,jdbcType=INTEGER},
      isCleared = #{iscleared,jdbcType=INTEGER}
    where id = #{id,jdbcType=INTEGER}
  </update>
 
   <select id="query_join" resultMap="CurrentAlarm" parameterType="CurrentAlarmInfo" >
     SELECT s.*, c.*,w.* FROM site_inst s, current_alarm c, warninglevel w WHERE s.site_inst_id = c.siteid AND 
     c.alarmcode = w.WarningCode AND c.alarmlevel = w.WarningLevel AND w.Manufacturer = 
    ( CASE WHEN ( SELECT co.codeValue FROM `code` co WHERE co.id = s.CellEditon ) = '0' THEN 1 ELSE 2 END ) 
   
  <if test="currentAlarm.id>0"> and c.id=#{currentAlarm.id}</if>
  <if test="currentAlarm.siteId!=0"> and c.siteid=#{currentAlarm.siteId}</if>
  <if test="currentAlarm.slotId!=0"> and c.slotId=#{currentAlarm.slotId}</if>
  <if test="currentAlarm.objectId!=0"> and c.objectid=#{currentAlarm.objectId}</if>
  <if test="currentAlarm.objectType!=null "> and c.objecttype=#{currentAlarm.objectType}</if>
  <if test="currentAlarm.alarmCode!=0"> and c.alarmcode=#{currentAlarm.alarmCode}</if>
  <if test="currentAlarm.alarmLevel!=0"> and c.alarmlevel=#{currentAlarm.alarmLevel}</if> 
  <if test="currentAlarm.warningLevel_temp !=0"> and c.alarmlevel_temp=#{currentAlarm.warningLevel_temp}</if>
  <if test="currentAlarm.alarmTime!=null and alarmTime!='' "> and c.happenedtime=#{currentAlarm.alarmTime}</if> 
  <if test="currentAlarm.objectName!=null and currentAlarm.objectName!='' "> and c.objectname=#{currentAlarm.objectName}</if>
    ORDER BY happenedtime desc
  </select>
<resultMap id="CurrentAlarm" type="CurrentAlarmInfo" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="siteid" property="siteId" jdbcType="INTEGER" />
    <result column="slotId" property="slotId" jdbcType="INTEGER" />
    <result column="objectid" property="objectId" jdbcType="INTEGER" />
    <result column="objecttype" property="objectType_db" jdbcType="INTEGER" />
    <result column="objectname" property="objectName" jdbcType="VARCHAR" />
    <result column="alarmcode" property="alarmCode" jdbcType="INTEGER" />
    <result column="alarmlevel" property="alarmLevel" jdbcType="INTEGER" />
    <result column="happenedtime" property="happenedtime" jdbcType="VARCHAR" />
    <result column="confirmtime" property="confirmtime" jdbcType="VARCHAR" />
    <result column="clearedtime" property="cleanTime" jdbcType="VARCHAR" />
    <result column="ackuser" property="ackUser" jdbcType="VARCHAR" />
    <result column="comments" property="comments" jdbcType="VARCHAR" />
    <result column="capabilityCode" property="capabilityCode" jdbcType="INTEGER" />
    <result column="capabilityIdentity" property="capabilityIdentity" jdbcType="VARCHAR" />
    <result column="alarmlevel_temp" property="warningLevel_temp" jdbcType="INTEGER" />
    <result column="isCleared" property="isClear" jdbcType="INTEGER" />
    <result column="CellId" property="siteName" jdbcType="INTEGER" />
    <collection property="warningLevel" ofType="WarningLevel" >
        <id property="warningcode" column="w.WarningCode"/>
        <result column="id" property="id" jdbcType="INTEGER" />
        <result column="warningname" property="warningname" jdbcType="VARCHAR" />
        <result column="warningnote" property="warningnote" jdbcType="INTEGER" />
        <result column="warninglevel" property="warninglevel" jdbcType="INTEGER" />
        <result column="warninglevel_temp" property="warninglevel_temp" jdbcType="INTEGER" />
        <result column="warningcode" property="warningcode" jdbcType="INTEGER" />
        <result column="warningobject" property="warningobject" jdbcType="VARCHAR" />
        <result column="warningtype" property="warningtype" jdbcType="INTEGER" />
        <result column="manufacturer" property="manufacturer" jdbcType="INTEGER" />
        <result column="warningdescribe" property="warningdescribe" jdbcType="INTEGER" />
        <result column="waringeffect" property="waringeffect" jdbcType="VARCHAR" />
        <result column="waringremark" property="waringremark" jdbcType="INTEGER" />
        <result column="warningadvice" property="warningadvice" jdbcType="INTEGER" />
        <result column="warningmayreason" property="warningmayreason" jdbcType="INTEGER" />
    </collection>
  </resultMap>


  <update id="updateObjectid" >
		update current_alarm set objectid = #{0} where objecttype =#{2} and objectid in #{1}
  </update>
  
  
   <select id="queryByClent" resultMap="CurrentAlarm" parameterType="CurrentAlarmInfo" >
   SELECT c.*,w.* FROM  current_alarm c, warninglevel w WHERE  c.alarmcode = w.WarningCode AND c.alarmlevel = w.WarningLevel AND w.Manufacturer =1 and c.objectname LIKE '%EMS服务器_%' 
   </select>
   
   <delete id="delete" parameterType="java.lang.Integer" >
   delete from current_alarm where id=#{curId}
  </delete>
</mapper>