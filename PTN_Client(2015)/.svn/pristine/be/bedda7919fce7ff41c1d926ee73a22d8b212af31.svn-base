package com.nms.db.bean.ptn.path;

import java.util.ArrayList;
import java.util.HashSet;
import java.util.List;
import java.util.Set;
import com.nms.db.bean.ptn.path.eth.ElanInfo;
import com.nms.db.bean.ptn.path.pw.PwInfo;
import com.nms.db.bean.ptn.path.pw.PwNniInfo;
import com.nms.db.bean.ptn.port.AcPortInfo;
import com.nms.model.ptn.path.ServiceInfoService;
import com.nms.model.ptn.path.eth.ElanInfoService;
import com.nms.model.ptn.path.pw.PwInfoService;
import com.nms.model.ptn.path.pw.PwNniBufferService;
import com.nms.model.ptn.port.AcInfoService;
import com.nms.model.util.Services;
import com.nms.ui.frame.ViewDataObj;
import com.nms.ui.manager.ConstantUtil;
import com.nms.ui.manager.ExceptionManage;
import com.nms.ui.manager.UiUtil;

public class StaticUnicastInfo extends ViewDataObj{
	
	/**
	 * 
	 */
	private static final long serialVersionUID = 85090669136248551L;
	private int id;
	private int suId;
	private int vplsVs;
	private int portChoice;
	private String macAddress;
	private int siteId;
		
	public int getSiteId() {
		return siteId;
	}

	public void setSiteId(int siteId) {
		this.siteId = siteId;
	}

	public int getId() {
		return id;
	}

	public void setId(int id) {
		this.id = id;
	}

	public int getSuId() {
		return suId;
	}

	public void setSuId(int suId) {
		this.suId = suId;
	}

	public int getVplsVs() {
		return vplsVs;
	}
	
	private String getPortChoiceName(){
		String port=null;
		AcInfoService acService = null;
		List<ElanInfo> elanInfoList = null;
		ElanInfoService elanInfoService = null;
		Set<Integer> acIdSet = null;
		List<Integer> pwIdList = null;
		List<PwInfo> pwIdList1 = null;
		List<Integer> acList = null;
		List<AcPortInfo> acInfoList = null;
		PwNniBufferService pwNniBufferService = null;
		PwInfoService pwInfoService = null;
		AcPortInfo acInfo = null;
		List<PwNniInfo>	pwNNIInfoList = null;
		UiUtil uiUtil = null;	
		try {
			acService = (AcInfoService) ConstantUtil.serviceFactory.newService(Services.AcInfo);			
			elanInfoService = (ElanInfoService) ConstantUtil.serviceFactory.newService(Services.ElanInfo);		
			pwNniBufferService =(PwNniBufferService)ConstantUtil.serviceFactory.newService(Services.PwNniBuffer);
			pwInfoService = (PwInfoService)ConstantUtil.serviceFactory.newService(Services.PwInfo);	
			String VplsName=getVplsName();
			ElanInfo elanInfo = new ElanInfo();
			elanInfo.setName(VplsName);			
			elanInfoList = elanInfoService.selectElan(elanInfo);		
			uiUtil = new UiUtil();
			acIdSet =  new HashSet<Integer>();
			pwIdList = new ArrayList<Integer>();
			for(int i=0;i<elanInfoList.size();i++){
				if(elanInfoList.get(i).getaSiteId() == siteId){
					acIdSet.addAll(uiUtil.getAcIdSets(elanInfoList.get(i).getAmostAcId()));
					pwIdList.add(elanInfoList.get(i).getPwId());
				}else if(elanInfoList.get(i).getzSiteId() == siteId){
					acIdSet.addAll(uiUtil.getAcIdSets(elanInfoList.get(i).getZmostAcId()));
					pwIdList.add(elanInfoList.get(i).getPwId());
				}
									
			}
			acList= new ArrayList<Integer>();
			for (Integer acId : acIdSet) {
				 acList.add(acId);					  
			}
			acInfoList = acService.select(acList);
			PwNniInfo pwNNIInfo= null;
			pwIdList1 = new ArrayList<PwInfo>();
			pwNNIInfoList = new ArrayList<PwNniInfo>();
		    for (Integer pwId : pwIdList) {
				 pwNNIInfo = new PwNniInfo();
				 pwNNIInfo.setSiteId(siteId);
				 pwNNIInfo.setPwId(pwId);
				 pwNNIInfoList.addAll(pwNniBufferService.select(pwNNIInfo));					 
				 pwIdList1.add(pwInfoService.selectByPwId(pwId));
			}
		    for(int i=0;i<pwIdList1.size();i++){
		    	for(int j=0;j<pwNNIInfoList.size();j++){
		    		if(pwIdList1.get(i).getPwId()==pwNNIInfoList.get(j).getPwId()){
		    			acInfo = new AcPortInfo();
		    			acInfo.setName(pwIdList1.get(i).getPwName());
		    			acInfo.setLanId(pwNNIInfoList.get(j).getLanId());
		    			acInfoList.add(acInfo);
		    			
		    		}
		    	}
		    }
		    for(AcPortInfo info : acInfoList){	
		    	if(info.getLanId()==getPortChoice()){
		    		port=info.getName();
		    		break;
		    	}
			  
			}
				  
		}catch (Exception e) {
			ExceptionManage.dispose(e,this.getClass());
		}finally{
			UiUtil.closeService(pwNniBufferService);
			UiUtil.closeService(acService);
			UiUtil.closeService(pwInfoService);
			elanInfoList = null;
			acIdSet = null;
			pwIdList = null;
			pwIdList1 = null;
			acList = null;
			acInfoList = null;
			acInfo = null;
			pwNNIInfoList = null;
			uiUtil = null;
		}  
		return port;
		
	}
	
	
	private String getVplsName()
	{
		int vsId = getVplsVs();
		int siteId = getSiteId();
		String serviceName="";
		ServiceInfoService serviceInfoService = null;
		try {
			serviceInfoService = (ServiceInfoService) ConstantUtil.serviceFactory.newService(Services.SERVICEINFO);
			serviceName = serviceInfoService.selectNameByXcId(vsId, siteId);
			
		}catch(Exception e) {
			ExceptionManage.dispose(e,this.getClass());
		} finally {
			UiUtil.closeService(serviceInfoService);
		}
		return serviceName;
	}

	public void setVplsVs(int vplsVs) {
		this.vplsVs = vplsVs;
	}

	public int getPortChoice() {
		return portChoice;
	}

	public void setPortChoice(int portChoice) {
		this.portChoice = portChoice;
	}

	public String getMacAddress() {
		return macAddress;
	}

	public void setMacAddress(String macAddress) {
		this.macAddress = macAddress;
	}

	@SuppressWarnings("unchecked")
	@Override
	public void putObjectProperty() {
		try {
			getClientProperties().put("id", getId());
			getClientProperties().put("suId", getSuId());
			getClientProperties().put("vplsVs", getVplsName());
			getClientProperties().put("portChoice", getPortChoiceName());
			getClientProperties().put("macAddress", getMacAddress());
		} catch (Exception e) {
			ExceptionManage.dispose(e,this.getClass());
		}
		
	}

}
